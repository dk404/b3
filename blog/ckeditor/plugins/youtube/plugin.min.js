(function(){CKEDITOR.plugins.add("youtube",{lang:["en","pt","ja","hu","it","fr","tr","ru","de","ar","nl","pl","vi","zh","el","he","es","nb","nn","fi","et","sk","cs"],init:function(a){a.addCommand("youtube",new CKEDITOR.dialogCommand("youtube",{allowedContent:"div{*}; iframe{*}[!width,!height,!src,!frameborder,!allowfullscreen]; object param[*]"}));a.ui.addButton("Youtube",{label:a.lang.youtube.button,toolbar:"insert",command:"youtube",icon:this.path+"images/icon.png"});CKEDITOR.dialog.add("youtube",function(b){var c;return{title:a.lang.youtube.title,minWidth:500,minHeight:200,contents:[{id:"youtubePlugin",expand:true,elements:[{id:"txtEmbed",type:"textarea",label:a.lang.youtube.txtEmbed,autofocus:"autofocus",onChange:function(d){handleEmbedChange(this,d)},onKeyUp:function(d){handleEmbedChange(this,d)},validate:function(){if(this.isEnabled()){if(!this.getValue()){alert(a.lang.youtube.noCode);return false}else{if(this.getValue().length===0||this.getValue().indexOf("//")===-1){alert(a.lang.youtube.invalidEmbed);return false}}}}},{type:"html",html:a.lang.youtube.or+"<hr>"},{type:"hbox",widths:["70%","15%","15%"],children:[{id:"txtUrl",type:"text",label:a.lang.youtube.txtUrl,onChange:function(d){handleLinkChange(this,d)},onKeyUp:function(d){handleLinkChange(this,d)},validate:function(){if(this.isEnabled()){if(!this.getValue()){alert(a.lang.youtube.noCode);return false}else{c=ytVidId(this.getValue());if(this.getValue().length===0||c===false){alert(a.lang.youtube.invalidUrl);return false}}}}},{type:"text",id:"txtWidth",width:"60px",label:a.lang.youtube.txtWidth,"default":a.config.youtube_width!=null?a.config.youtube_width:"640",validate:function(){if(this.getValue()){var d=parseInt(this.getValue())||0;if(d===0){alert(a.lang.youtube.invalidWidth);return false}}else{alert(a.lang.youtube.noWidth);return false}}},{type:"text",id:"txtHeight",width:"60px",label:a.lang.youtube.txtHeight,"default":a.config.youtube_height!=null?a.config.youtube_height:"360",validate:function(){if(this.getValue()){var d=parseInt(this.getValue())||0;if(d===0){alert(a.lang.youtube.invalidHeight);return false}}else{alert(a.lang.youtube.noHeight);return false}}}]},{type:"hbox",widths:["100%"],children:[{id:"chkResponsive",type:"checkbox",label:a.lang.youtube.txtResponsive,"default":a.config.youtube_responsive!=null?a.config.youtube_responsive:false}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkRelated",type:"checkbox","default":a.config.youtube_related!=null?a.config.youtube_related:true,label:a.lang.youtube.chkRelated},{id:"chkOlderCode",type:"checkbox","default":a.config.youtube_older!=null?a.config.youtube_older:false,label:a.lang.youtube.chkOlderCode}]},{type:"hbox",widths:["55%","45%"],children:[{id:"chkPrivacy",type:"checkbox",label:a.lang.youtube.chkPrivacy,"default":a.config.youtube_privacy!=null?a.config.youtube_privacy:false},{id:"chkAutoplay",type:"checkbox","default":a.config.youtube_autoplay!=null?a.config.youtube_autoplay:false,label:a.lang.youtube.chkAutoplay}]},{type:"hbox",widths:["55%","45%"],children:[{id:"txtStartAt",type:"text",label:a.lang.youtube.txtStartAt,validate:function(){if(this.getValue()){var d=this.getValue();if(!/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/i.test(d)){alert(a.lang.youtube.invalidTime);return false}}}},{id:"empty",type:"html",html:""}]}]}],onOk:function(){var j="";var g="";if(this.getContentElement("youtubePlugin","txtEmbed").isEnabled()){j=this.getValueOf("youtubePlugin","txtEmbed")}else{var d="//",f=[],i;var e=this.getValueOf("youtubePlugin","txtWidth");var m=this.getValueOf("youtubePlugin","txtHeight");if(this.getContentElement("youtubePlugin","chkPrivacy").getValue()===true){d+="www.youtube-nocookie.com/"}else{d+="www.youtube.com/"}d+="embed/"+c;if(this.getContentElement("youtubePlugin","chkRelated").getValue()===false){f.push("rel=0")}if(this.getContentElement("youtubePlugin","chkAutoplay").getValue()===true){f.push("autoplay=1")}i=this.getValueOf("youtubePlugin","txtStartAt");if(i){var k=hmsToSeconds(i);f.push("start="+k)}if(f.length>0){d=d+"?"+f.join("&")}if(this.getContentElement("youtubePlugin","chkResponsive").getValue()===true){j+='<div class="youtube-embed-wrapper" style="position:relative;padding-bottom:56.25%;padding-top:30px;height:0;overflow:hidden;">';g='style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;"'}if(this.getContentElement("youtubePlugin","chkOlderCode").getValue()===true){d=d.replace("embed/","v/");d=d.replace(/&/g,"&amp;");if(d.indexOf("?")===-1){d+="?"}else{d+="&amp;"}d+="hl="+(this.getParentEditor().config.language?this.getParentEditor().config.language:"en")+"&amp;version=3";j+='<object width="'+e+'" height="'+m+'" '+g+">";j+='<param name="movie" value="'+d+'"></param>';j+='<param name="allowFullScreen" value="true"></param>';j+='<param name="allowscriptaccess" value="always"></param>';j+='<embed src="'+d+'" type="application/x-shockwave-flash" ';j+='width="'+e+'" height="'+m+'" '+g+' allowscriptaccess="always" ';j+='allowfullscreen="true"></embed>';j+="</object>"}else{j+='<iframe width="'+e+'" height="'+m+'" src="'+d+'" '+g;j+='frameborder="0" allowfullscreen></iframe>'}if(this.getContentElement("youtubePlugin","chkResponsive").getValue()===true){j+="</div>"}}var h=CKEDITOR.dom.element.createFromHtml(j);var l=this.getParentEditor();l.insertElement(h)}}})}})})();function handleLinkChange(b,a){if(b.getValue().length>0){b.getDialog().getContentElement("youtubePlugin","txtEmbed").disable()}else{b.getDialog().getContentElement("youtubePlugin","txtEmbed").enable()}}function handleEmbedChange(b,a){if(b.getValue().length>0){b.getDialog().getContentElement("youtubePlugin","txtUrl").disable()}else{b.getDialog().getContentElement("youtubePlugin","txtUrl").enable()}}function ytVidId(a){var b=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;return(a.match(b))?RegExp.$1:false}function hmsToSeconds(d){var b=d.split(":"),c=0,a=1;while(b.length>0){c+=a*parseInt(b.pop(),10);a*=60}return c};